
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> options(STERM='iESS', str.dendrogram.last="'", editor='emacsclient', show.error.locations=TRUE)
> ReportYear <- 2014
> knitr::knit2pdf("NORIC_2014.Rnw")


processing file: NORIC_2014.Rnw
  |.                                                                |   1%
  ordinary text without R code

  |..                                                               |   3%
label: variables (with options) 
List of 1
 $ include: logi FALSE

  |...                                                              |   4%
  ordinary text without R code

  |....                                                             |   6%
label: loadlibs (with options) 
List of 1
 $ include: logi FALSE

  |.....                                                            |   7%
  ordinary text without R code

  |......                                                           |   9%
label: DefineFunc (with options) 
List of 1
 $ include: logi FALSE

  |.......                                                          |  10%
  ordinary text without R code

  |........                                                         |  12%
label: graphicsoptions (with options) 
List of 1
 $ include: logi FALSE

  |........                                                         |  13%
  ordinary text without R code

  |.........                                                        |  14%
label: DBconnect (with options) 
List of 1
 $ include: logi FALSE

  |..........                                                       |  16%
  ordinary text without R code

  |...........                                                      |  17%
label: LoadRawTables (with options) 
List of 1
 $ include: logi FALSE

  |............                                                     |  19%
  ordinary text without R code

  |.............                                                    |  20%
label: SOPrepare (with options) 
List of 1
 $ include: logi FALSE

  |..............                                                   |  22%
  ordinary text without R code

  |...............                                                  |  23%
label: AsDateConversion (with options) 
List of 1
 $ include: logi FALSE

  |................                                                 |  25%
  ordinary text without R code

  |.................                                                |  26%
label: CalcDays (with options) 
List of 1
 $ include: logi FALSE

  |..................                                               |  28%
  ordinary text without R code

  |...................                                              |  29%
label: TnegNA (with options) 
List of 1
 $ include: logi FALSE

  |....................                                             |  30%
  ordinary text without R code

  |.....................                                            |  32%
label: APfiltering (with options) 
List of 1
 $ include: logi FALSE

  |......................                                           |  33%
  ordinary text without R code

  |.......................                                          |  35%
label: APrecodes (with options) 
List of 1
 $ include: logi FALSE

  |........................                                         |  36%
  ordinary text without R code

  |........................                                         |  38%
label: APMainTimeLine (with options) 
List of 1
 $ include: logi FALSE

  |.........................                                        |  39%
  ordinary text without R code

  |..........................                                       |  41%
label: subsetting (with options) 
List of 1
 $ include: logi FALSE

  |...........................                                      |  42%
   inline R code fragments

  |............................                                     |  43%
label: FigNPros (with options) 
List of 5
 $ fig.cap   : chr "Antall prosedyrer etter måned og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |.............................                                    |  45%
  ordinary text without R code

  |..............................                                   |  46%
label: TabNPros (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |...............................                                  |  48%
  ordinary text without R code

  |................................                                 |  49%
label: FigNHendelsesType (with options) 
List of 5
 $ fig.cap   : chr "Antall primær prosedyrer etter hastegrad og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |.................................                                |  51%
  ordinary text without R code

  |..................................                               |  52%
label: TabNHendelsesType (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |...................................                              |  54%
  ordinary text without R code

  |....................................                             |  55%
label: FigRHendelsesType (with options) 
List of 5
 $ fig.cap   : chr "Prosent andel primær prosedyrer etter hastegrad og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |.....................................                            |  57%
  ordinary text without R code

  |......................................                           |  58%
label: TabRHendelsesType (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |.......................................                          |  59%
  ordinary text without R code

  |........................................                         |  61%
label: FigNProsedyreType (with options) 
List of 5
 $ fig.cap   : chr "Antall primær prosedyrer etter type og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |.........................................                        |  62%
  ordinary text without R code

  |.........................................                        |  64%
label: TabNProsedyreType (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |..........................................                       |  65%
  ordinary text without R code

  |...........................................                      |  67%
label: FigRProsedyreType (with options) 
List of 5
 $ fig.cap   : chr "Prosent andel primær prosedyrer etter type og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |............................................                     |  68%
  ordinary text without R code

  |.............................................                    |  70%
label: TabRProsedyreType (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |..............................................                   |  71%
  ordinary text without R code

  |...............................................                  |  72%
label: FigNIndikasjon (with options) 
List of 5
 $ fig.cap   : chr "Antall primær prosedyrer etter type og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |................................................                 |  74%
  ordinary text without R code

  |.................................................                |  75%
label: TabNIndikasjon (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |..................................................               |  77%
  ordinary text without R code

  |...................................................              |  78%
label: FigRIndikasjon2 (with options) 
List of 5
 $ fig.cap   : chr "Prosent andel primær prosedyrer etter type og PCI senter"
 $ echo      : logi FALSE
 $ fig.width : num 8
 $ fig.height: num 4
 $ out.width : chr "\\textwidth"

  |....................................................             |  80%
  ordinary text without R code

  |.....................................................            |  81%
label: TabRIndikasjon (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |......................................................           |  83%
  ordinary text without R code

  |.......................................................          |  84%
label: TabNTillegg (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |........................................................         |  86%
  ordinary text without R code

  |.........................................................        |  87%
label: SOtab1 (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |.........................................................        |  88%
  ordinary text without R code

  |..........................................................       |  90%
label: SOtab1b (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |...........................................................      |  91%
  ordinary text without R code

  |............................................................     |  93%
label: SOtab2 (with options) 
List of 2
 $ echo   : logi FALSE
 $ results: chr "asis"

  |.............................................................    |  94%
  ordinary text without R code

  |..............................................................   |  96%
label: FigT2T (with options) 
List of 6
 $ fig.cap   : chr "Fordeling av ventetid fra indeks innleggelse til prosedyre for henviste NSTEMI pasienter etter PCI senter"
 $ fig.height: num 4
 $ fig.width : num 8
 $ out.width : chr "\\textwidth"
 $ warning   : logi FALSE
 $ echo      : logi FALSE

  |...............................................................  |  97%
  ordinary text without R code

  |................................................................ |  99%
label: T2Ttable (with options) 
List of 3
 $ results: chr "asis"
 $ echo   : logi FALSE
 $ warning: logi FALSE

  |.................................................................| 100%
  ordinary text without R code


output file: NORIC_2014.tex

[1] "NORIC_2014.pdf"
Warning messages:
1: Removed 257 rows containing non-finite values (stat_density). 
2: Removed 244 rows containing non-finite values (stat_density). 
3: Removed 334 rows containing non-finite values (stat_density). 
4: Removed 277 rows containing non-finite values (stat_density). 
5: Removed 346 rows containing non-finite values (stat_density). 
6: Removed 223 rows containing non-finite values (stat_density). 
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Indikasjon2 ,
+         group = Sykehusnavn )
+     ) +
+     geom_histogram( aes( fill = Sykehusnavn ))
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Month ,
+         group = Sykehusnavn )
+     ) +
+     geom_histogram( aes( fill = Sykehusnavn ))
> @
Error: unexpected '@' in "@"
> str(AP)
'data.frame':	18326 obs. of  54 variables:
 $ Sykehusnavn                          : Factor w/ 6 levels "Haukeland","Sørlandet",..: 4 5 5 2 5 2 5 2 5 5 ...
 $ ForlopsID                            : num  17 37 38 38 39 39 40 40 41 42 ...
 $ PrimaerForlopsID                     : num  NA NA NA NA NA NA NA NA NA NA ...
 $ PasientID                            : num  14 34 35 38 36 39 37 40 38 39 ...
 $ Kjonn                                : chr  "Mann" "Mann" "Mann" "Mann" ...
 $ Vekt                                 : num  93 87 82 92 80 90 90 80 54 83 ...
 $ Hoyde                                : num  193 170 170 177 178 178 180 185 160 180 ...
 $ FodselsDato                          : Date, format: "1969-05-25" "1977-01-11" ...
 $ ProsedyreDato                        : Date, format: "2014-01-27" "2014-01-01" ...
 $ AnkomstPCIDato                       : Date, format: "2014-01-27" "2014-01-01" ...
 $ AnkomstPCITid                        : chr  "00:00:00" "00:00:00" "00:00:00" "" ...
 $ Aortaballongpumpe                    : chr  "" "Nei" "" "" ...
 $ ArteriellLukning                     : chr  "Kompresjonsrull" "RadiStop" "AngioSeal" "Kompresjonsrull" ...
 $ CanadianClass                        : chr  "I" "" "" "" ...
 $ DatoInnleggelseIHenvisendeSykehus    : Date, format: NA NA ...
 $ Diabetes                             : chr  "Nei" "Nei" "Nei" "Nei" ...
 $ Doppler                              : chr  "" "" "" "" ...
 $ FFR                                  : chr  "" "" "" "" ...
 $ Funn                                 : chr  "1-kar ikke HS" "2-kar ikke HS" "3-kar ikke HS" "3-kar ikke HS" ...
 $ HendelsesType                        : chr  "Akutt" "Akutt" "Akutt" "Planlagt" ...
 $ Hypertoni                            : chr  "Ja" "Nei" "Ja" "Nei" ...
 $ Indikasjon                           : chr  "Stabil koronarsykdom " "STEMI" "NSTEMI" "Stum ischemi" ...
 $ Infarkttype                          : chr  "" "" "" "" ...
 $ Innkomstarsak                        : chr  "Brystsmerter" "Brystsmerter" "Brystsmerter" "" ...
 $ InnleggelsesdatoDetteSykehus         : chr  NA NA NA NA ...
 $ IVUS                                 : chr  "" "" "" "" ...
 $ KillipKlasse                         : chr  "Killip I" "Killip I" "Killip I" "" ...
 $ KjentNedsattVenstVentr               : chr  "Nei" "Nei" "Ukjent" "Nei" ...
 $ Komplikasjon                         : chr  "" "Nei" "Nei" "Nei" ...
 $ Kontrastmiddel                       : chr  "Iomeron, 300 mgI/ml" "Iomeron, 350 mgI/ml" "Iomeron, 350 mgI/ml" "Visipaque, 320 mgI/ml" ...
 $ NYHA                                 : chr  "I" "" "" "" ...
 $ OCT                                  : chr  "" "" "" "" ...
 $ OverflyttetFra                       : chr  "Nei, direkte inn til dette sykehus" "Nei, direkte inn til dette sykehus" "Nei, direkte inn til dette sykehus" "" ...
 $ OverflyttetFraSykehus                : chr  "" "" "" "" ...
 $ PrimarBeslutning                     : chr  "PCI ad hoc" "PCI ad hoc" "PCI ad hoc" "ACB-operasjon" ...
 $ ProsedyreType                        : chr  "Angio" "Angio + PCI" "Angio + PCI" "Angio" ...
 $ RoykeStatus                          : chr  "Eks-rÃ¸yker >1 mnd" "Aldri rÃ¸ykt" "Eks-rÃ¸yker >1 mnd" "Aldri rÃ¸ykt" ...
 $ Stikksted                            : chr  "A radialis hÃ¸yre" "A radialis hÃ¸yre" "A femoralis" "A radialis hÃ¸yre" ...
 $ SekundaerBeslutning                  : chr  "" "Annet" "Ingen ytterligere behandling" "" ...
 $ SymptomDato                          : Date, format: NA "2014-01-01" ...
 $ SymptomTidspunkt                     : chr  "" "" "00:00:00" "" ...
 $ TidlABC                              : chr  "Ja" "Nei" "Ja" "Nei" ...
 $ TidlInfarkt                          : chr  "Ja" "Nei" "Ja" "Nei" ...
 $ TidlPCI                              : chr  "Ja" "Nei" "Ja" "Nei" ...
 $ Utskrivningsdato                     : chr  NA "2014-01-02" "2014-01-08" "2014-01-02" ...
 $ Vakttid                              : chr  "Akuttilfelle pÃ¥ dagtid" "Akuttilfelle i vakttid" "Akuttilfelle i vakttid" "Planlagt pÃ¥ dagtid" ...
 $ DaysFromSymptomToIndexAdmission      : num  NA NA NA NA NA NA NA NA NA NA ...
 $ DaysFromIndexAdmissionToProcedure    : num  NA NA NA NA NA NA NA NA NA NA ...
 $ DaysFromPCIcenterAdmissionToProcedure: num  0 0 0 NA 0 NA 0 NA NA NA ...
 $ Year                                 : num  2014 2014 2014 2014 2014 ...
 $ AdmissionType                        : chr  "Directly admitted" "Directly admitted" "Directly admitted" NA ...
 $ Indikasjon2                          : Factor w/ 6 levels "Uklare brystsmerter",..: 2 5 4 6 5 2 5 4 4 2 ...
 $ Month                                : Factor w/ 12 levels "2014-01","2014-02",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Day                                  : num  26 0 0 1 0 1 0 1 1 1 ...
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Kjonn ,
+         group = Sykehusnavn )
+     ) +
+     geom_histogram( aes( fill = Sykehusnavn ))
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Sykehusnavn ,
+         group = Kjonn )
+     ) +
+     geom_histogram( aes( fill = Kjonn ))
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Sykehusnavn ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram( aes( fill = Kjonn ))
> ggplot(
+     data = AP ,
+     mapping = aes(
+         x = Sykehusnavn ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Kjonn ) ,
+         position = "fill")
> prop.table( xtabs( ~ Kjonn + Sykehusnavn , data = AP , subset = is.na(PrimaerForlopsID) ) , margin = 1)
        Sykehusnavn
Kjonn     Haukeland  Sørlandet   St. Olav        SUS    Ullevål        UNN
  Kvinne 0.04954709 0.04414493 0.05391247 0.03263123 0.06930045 0.05473098
  Mann   0.12026629 0.09647495 0.13030667 0.06864564 0.16763069 0.11240860
> prop.table( xtabs( ~ Kjonn + Sykehusnavn , data = AP , subset = is.na(PrimaerForlopsID) ) , margin = 2)
        Sykehusnavn
Kjonn     Haukeland  Sørlandet   St. Olav        SUS    Ullevål        UNN
  Kvinne 0.16284075 0.14508608 0.17718795 0.10724534 0.22776184 0.17987805
  Mann   0.17286275 0.13866667 0.18729412 0.09866667 0.24094118 0.16156863
> prop.table( xtabs( ~ Kjonn + Sykehusnavn , data = AP , subset = is.na(PrimaerForlopsID) ) , margin = 2)
        Sykehusnavn
Kjonn    Haukeland Sørlandet  St. Olav       SUS   Ullevål       UNN
  Kvinne 0.2917738 0.3139309 0.2926540 0.3221983 0.2924919 0.3274567
  Mann   0.7082262 0.6860691 0.7073460 0.6778017 0.7075081 0.6725433
> PrimaerAngio <- subset(
+     x = AP ,
+     subset = ProsedyreType == "Angio" )
> table(PrimaerAngio$ProsedyreType)

      Angio Angio + PCI         PCI 
      10856        7008         462 
> table(PrimaerAngio$ProsedyreType)

Angio 
10856 
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Funn ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Kjonn ) ,
+         position = "fill")
> unique(AP$Funn)
NULL
> unique(AP$Funn)
 [1] "1-kar ikke HS"                "2-kar ikke HS"               
 [3] "3-kar ikke HS"                "Normalt /Ateromatos"         
 [5] "HS + 1-kar"                   "HS + 3-kar"                  
 [7] "HS + 2-kar"                   "Ikke konklusiv undersÃ¸kelse"
 [9] "HS"                           ""                            
> AP $ Stenose <- factor(
+     car::recode(
+         var = AP $ Funn ,
+         recodes = "
+             'Normalt /Ateromatos'='Nei';
+             '1-kar ikke HS'='Ja';
+             '2-kar ikke HS'='Ja';
+             '3-kar ikke HS'='Ja';
+             'HS + 1-kar'='Ja';
+             'HS + 2-kar'='Ja';
+             'HS + 3-kar'='Ja';
+             else='Ukjent';
+             ")
+     )
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Stenose ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Kjonn ) ,
+         position = "fill")
Error in eval(expr, envir, enclos) : object 'Stenose' not found
> AP $ Stenose <- factor(
+     car::recode(
+         var = AP $ Funn ,
+         recodes = "
+             'Normalt /Ateromatos'='Nei';
+             '1-kar ikke HS'='Ja';
+             '2-kar ikke HS'='Ja';
+             '3-kar ikke HS'='Ja';
+             'HS + 1-kar'='Ja';
+             'HS + 2-kar'='Ja';
+             'HS + 3-kar'='Ja';
+             else='Ukjent';
+             ")
+     )
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Stenose ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Kjonn ) ,
+         position = "fill")
Error in eval(expr, envir, enclos) : object 'Stenose' not found
> PrimaerAngio <- subset(
+     x = AP ,
+     subset = ProsedyreType == "Angio" )
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Stenose ,
+         y = ..density.. ,
+         group = Kjonn )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Kjonn ) ,
+         position = "fill")
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Kjonn ,
+         y = ..density.. ,
+         group = Stenose )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Stenose ) ,
+         position = "fill")
> print.xtable(
+     x = xtable(
+         100 * prop.table(
+             xtabs(
+                 formula = ~ Stenose + Kjonn ,
+                 subset = is.na( PrimaerForlopsID ) ,
+                 data = AP) ,
+             margin = 2) ,
+         caption = "Prosentandel negative funn under primær hjertekateterisering etter kjønn" ,
+         digits = 1) ,
+     booktabs = TRUE )
% latex table generated in R 3.2.2 by xtable 1.7-4 package
% Mon Sep 21 09:55:18 2015
\begin{table}[ht]
\centering
\begin{tabular}{rrr}
  \toprule
 & Kvinne & Mann \\ 
  \midrule
Ja & 49.4 & 70.4 \\ 
  Nei & 49.3 & 28.3 \\ 
  Ukjent & 1.4 & 1.3 \\ 
   \bottomrule
\end{tabular}
\caption{Prosentandel negative funn under primær hjertekateterisering etter kjønn} 
\end{table}
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Kjonn ,
+         y = ..density.. ,
+         group = Stenose )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Stenose ) ,
+         position = "dodge")
> ?stat_bin
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Kjonn ,
+         y = ..ndensity.. ,
+         group = Stenose )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Stenose ) ,
+         position = "dodge")
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Kjonn ,
+         y = ..ncount.. ,
+         group = Stenose )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Stenose ) ,
+         position = "dodge")
> ggplot(
+     data = PrimaerAngio ,
+     mapping = aes(
+         x = Kjonn ,
+         y = ..count.. ,
+         group = Stenose )
+     ) +
+     geom_histogram(
+         aes(
+             fill = Stenose ) ,
+         position = "dodge")
> glm( Stenose ~ Alder + Kjonn , data = PrimaerAngio , family = "binomial" )
Error in eval(expr, envir, enclos) : object 'Alder' not found
> ?diff.date
> ?diff
> ?diff
> AP $ Age <- as.numeric(
+     AP $ ProsedyreDato - AP $ FodselsDato )
> AP $ Alder <- as.numeric(
+     AP $ ProsedyreDato - AP $ FodselsDato )
> glm( Stenose ~ Age + Kjonn , data = PrimaerAngio , family = "binomial" )
Error in eval(expr, envir, enclos) : object 'Alder' not found
> glm( Stenose ~ Alder + Kjonn , data = PrimaerAngio , family = "binomial" )
Error in eval(expr, envir, enclos) : object 'Age' not found
> 